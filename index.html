<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  

  
  <title>Bob的技术博客</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="关于iOS及其他软件技术的交流博客">
<meta property="og:type" content="website">
<meta property="og:title" content="Bob的技术博客">
<meta property="og:url" content="https://tianxianbob.github.io/index.html">
<meta property="og:site_name" content="Bob的技术博客">
<meta property="og:description" content="关于iOS及其他软件技术的交流博客">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="bob">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="Bob的技术博客" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  
<link rel="stylesheet" href="/css/style.css">

<meta name="generator" content="Hexo 5.4.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Bob的技术博客</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="搜索"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://TianXianBob.github.io"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-hello-world" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2021/08/04/hello-world/" class="article-date">
  <time datetime="2021-08-04T05:18:48.741Z" itemprop="datePublished">2021-08-04</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2021/08/04/hello-world/">Hello World</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Welcome to <a target="_blank" rel="noopener" href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a target="_blank" rel="noopener" href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a target="_blank" rel="noopener" href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a target="_blank" rel="noopener" href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">&quot;My New Post&quot;</span></span><br></pre></td></tr></table></figure>

<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/writing.html">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure>

<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/server.html">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure>

<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/generating.html">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure>

<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://tianxianbob.github.io/2021/08/04/hello-world/" data-id="ckrx1m5nk0000zbzbh5l52gmu" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-SVN到git的迁移" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/01/27/SVN%E5%88%B0git%E7%9A%84%E8%BF%81%E7%A7%BB/" class="article-date">
  <time datetime="2019-01-26T16:00:00.000Z" itemprop="datePublished">2019-01-27</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E6%8A%80%E6%9C%AF/">技术</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/01/27/SVN%E5%88%B0git%E7%9A%84%E8%BF%81%E7%A7%BB/">SVN到Git的迁移</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h4 id="为什么要迁移"><a href="#为什么要迁移" class="headerlink" title="为什么要迁移"></a>为什么要迁移</h4><p>在小团队小项目中，SVN固然是非常好用的。SVN的模式是中央集权式的。正常情况下多人共享一份远端代码，同事之间会有较多的冲突。拉取分支也需要完整的copy的一遍。<br>相对于SVN，Git则更强调个体。拉取分支是指针式的，非常方便。无需联网即可提交。Git的分布式管理，让每个用户都是一个终端。这样无需刻意的去备份代码。</p>
<h4 id="如何迁移"><a href="#如何迁移" class="headerlink" title="如何迁移"></a>如何迁移</h4><p>最傻瓜的做法</p>
<ol>
<li>创建git仓库</li>
<li>clone远端的git仓库到本地</li>
<li>copy一份svn的代码到本地的git仓库</li>
<li>推送本地仓库到远端</li>
</ol>
<p>但是这样的话，在SVN上的提交信息和分支，TAG都会丢失。</p>
<p>所以接下来需要说一下如何把svn上的记录同步迁移到git上。</p>
<p><strong>创建用户映射</strong><br>在SVN上的每一个开发用户都有一个用户名。我们需要创建一个user.txt的文件，罗列出所有有提交记录的用户。格式如下:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Bob = Bob &lt;Bob@qq.com&gt;</span><br><span class="line">Bill = Bill &lt;Bill@qq.com&gt;</span><br></pre></td></tr></table></figure>
<p>如果，用户太多，容易遗漏怎么办，可以直接导出svn的作者信息:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">svn log ^/ --xml | grep -p &quot;^&lt;author&quot; | sort -u | perl -pe &#x27;s/&lt;author&gt;(.*?)&lt;\/author&gt;/$1 = /&#x27; &gt; users.txt</span><br></pre></td></tr></table></figure>

<p><strong>克隆项目</strong><br>通过 git svn clone 命令可以把整个 SVN 仓库导入到一个本地的 git 仓库中, 但这样导入的代码提交历史很糟糕, 需要做一些处理. 在 clone 后面添加 –no-metadata 来阻止 git svn 包含那些 SVN 的附加信息。同时为了获得更精确的提交者 ID 和邮箱, 添加 –authors-file 参数</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git svn clone svn://chenxingchen@192.168.51.110/tugou-app/ios/decor --authors-file=users.txt --no-metadata -s XXXXX</span><br></pre></td></tr></table></figure>

<p><strong>Branches和Tags处理</strong><br>SVN 中是常见的 “trunk/branches/tags” 目录结构，所以需要将 SVN 的 branches 和标签 tags 生成对应的git的分支和标签.<br>处理branches：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git for-each-ref refs/remotes | cut -d / -f 3- | grep -v @ | while read branchname; do git branch &quot;$branchname&quot; &quot;refs/remotes/$branchname&quot;; git branch -r -d &quot;$branchname&quot;; done</span><br></pre></td></tr></table></figure>
<p>处理tags：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git for-each-ref refs/remotes/tags | cut -d / -f 4- | grep -v @ | while read tagname; do git tag &quot;$tagname&quot; &quot;tags/$tagname&quot;; git branch -r -d &quot;tags/$tagname&quot;; done</span><br></pre></td></tr></table></figure>

<p><strong>问题</strong><br>1.is too old (format 29) to work with client version ‘xxxx (r1591380)’ (expects format 31).<br>到对应svn目录下执行</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">svn upgrade</span><br></pre></td></tr></table></figure>
<p>2.Request Entity Too Large<br>通过ssh的方式去上传项目就解决了。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://tianxianbob.github.io/2019/01/27/SVN%E5%88%B0git%E7%9A%84%E8%BF%81%E7%A7%BB/" data-id="ckrx1o4v5000abqzbakc0gm9o" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Git/" rel="tag">Git</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-汕头-广州游玩Plan" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/01/15/%E6%B1%95%E5%A4%B4-%E5%B9%BF%E5%B7%9E%E6%B8%B8%E7%8E%A9Plan/" class="article-date">
  <time datetime="2019-01-14T16:00:00.000Z" itemprop="datePublished">2019-01-15</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E9%9A%8F%E7%AC%94/">随笔</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/01/15/%E6%B1%95%E5%A4%B4-%E5%B9%BF%E5%B7%9E%E6%B8%B8%E7%8E%A9Plan/">汕头-广州游玩Plan</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <ul>
<li>天数 : 7</li>
<li>时间 : 1月23日-1月29日</li>
<li>预算 : 6k</li>
<li>伙伴 : 湖州第一才女</li>
<li>气温 : 15～17🌡️     </li>
</ul>
<h3 id="Day-0-1-22"><a href="#Day-0-1-22" class="headerlink" title="Day 0 1-22"></a>Day 0 1-22</h3><p>由于飞机起飞的时间很早，而国内航班又需要提前1.5小时到达机场。所以暂定22号晚上就启程前往萧山机场～在机场凑活一夜。（苦逼～）<br>乘坐晚上8点左右的机场大巴（¥20/人）<br>05:00—17:00每15分钟1班<br>17:00—21:00每30分钟1班</p>
<h3 id="Day-1-1-23"><a href="#Day-1-1-23" class="headerlink" title="Day 1 1-23"></a>Day 1 1-23</h3><p> <strong>2019-01-23 6:55 —— 2019-01-23 8:50<br> From : 萧山机场<br> To   : 潮汕机场</strong></p>
<p>到达潮汕机场后乘坐汕头潮汕机场专线（¥24/人），大约1个小时的车程来到了汕头市区。（酒店暂定）到达酒店入住，住宿暂定7天（¥180/日）。<br>汕头的吃货之旅就此始～</p>
<p>—————— 此处须坐车（33路/10路/1路/打车¥10）———————</p>
<p><strong>汕头老城</strong><br>欧式的建筑，斑驳的墙面。每个角落都很有味道，厚重年代感应该能给我这个文艺(无趣)青年新鲜感。</p>
<p><strong>飘香小食</strong><br>50多年的老店，是潮州小吃的集大成者，从各种粿到蚝烙牛肉丸，应有尽有，似乎已经包罗了绝大多数能想到的潮汕特色小食。</p>
<p><strong>老妈宫粽球</strong><br>1920年创建的，至今已经将近百年，几乎每个来汕头旅行的人都不会错过这里。招牌双烹粽球（¥10）就是一半甜、一半咸。</p>
<p><strong>爱西干面</strong><br>标配就是干面和猪杂汤这对儿“黄金搭档”（¥20）</p>
<p><strong>糖葱薄饼</strong><br>一张风吹饼，卷着糖浆拉拔成的白色长条糖葱，配以芝麻和香菜，一口下去，酥脆、甘甜。（¥5）</p>
<p><strong>鲎粿(hòuguõ)</strong><br>鲎粿，一般就是番薯粉为主料，加虾、蛋、香菇、鱿鱼等，先做成粿型蒸熟，再用油煮。</p>
<p><strong>广场老牌豆花甜汤</strong><br>口感很厚实，豆香浓郁。就是好吃啦。（¥3）</p>
<p><strong>海鲜大排档</strong><br>晚餐，暂定，在磐石大桥附近有很多店可挑选。</p>
<p>今天没有夜生活，吃完晚饭，在海滨走走，即可休息。</p>
<h3 id="Day-2-1-24"><a href="#Day-2-1-24" class="headerlink" title="Day 2 1-24"></a>Day 2 1-24</h3><p><strong>海记牛肉店</strong><br>这家店曾经被《舌尖上的中国》详细介绍过，以新鲜的牛肉火锅闻名，已经在多个地方开分店。当然是吃货首选！</p>
<p><strong>亚强果汁冰</strong><br>餐后甜点～几乎我看过的每一个攻略都推荐了这个果汁冰，虽然不爱吃冰，但还是很想尝试一下的赶脚。</p>
<p><strong>建业酒家</strong><br>鹅肝</p>
<p>15点之前，前往汕头动车站赶16:27的动车（从住处车程约1小时）<br>注意:不支持身份证进站，建议16点前到站取票。</p>
<p>19:55到达广州东站。</p>
<p>视住宿而定晚上逛逛。</p>
<h3 id="Day-3-1-25"><a href="#Day-3-1-25" class="headerlink" title="Day 3 1-25"></a>Day 3 1-25</h3><p>路线，初拟<br>石室圣心大教堂(1小时) → 沙面(3小时) → 恩宁路(小时) → 陈家祠(1小时) → 上下九步行街(3小时)</p>
<p><strong>沙面公园</strong><br>曾经十多个国家在沙面设立领事馆，9家外国银行，40多家洋行在沙面成立，沙面见证了广州近代史的变迁。这里是湖州大才女的自拍天堂。沙面公园可以游玩一个下午</p>
<p>以下是上下九附近的街道及对应的名小吃:<br><strong>十铺路</strong><br>1.南信牛奶甜品专家<br>2.陶陶居（虾饺、凤爪、牛羊杂汤、奶黄包、榴莲酥）</p>
<p><strong>宝华路</strong><br>1.顺记冰室<br>2.银记肠粉(宝华路店)<br>3.陈添记鱼皮/艇仔粥<br>4.文记壹心鸡</p>
<p><strong>逢源路</strong><br>1.国强粥粉面（艇仔粥和炒牛河）</p>
<p><strong>多宝路</strong><br>1.黄征龙凉茶<br>2.新联肠粉店（布拉肠粉，只开上午）</p>
<p><strong>恩宁路</strong><br>广州最美老街。除了奇楼，还有许多文教古迹。恩宁路177号是八和会馆，以前是粤剧艺人的自发组织成立的行会，每年从世界各地赶来这里寻根的粤剧艺人或爱好者不计其数，他们都是源自这里的“八和子弟”。十二甫西街芽菜巷42号是詹天佑的故居。金声电影院的牌楼，李小龙祖居。</p>
<h3 id="Day-4-1-26"><a href="#Day-4-1-26" class="headerlink" title="Day 4 1-26"></a>Day 4 1-26</h3><p>越秀公园(2小时) → 中山纪念堂(2小时) → 北京路步行街(3小时) → 珠江夜游(1小时)</p>
<p><strong>越秀公园</strong></p>
<p>—————————— 地铁2号线 ——————————</p>
<p><strong>中山纪念堂</strong></p>
<p>—————————— 地铁2号线 → 地铁6号线 ————————</p>
<p><strong>北京路步行街</strong><br>1.芳记小食店<br>2.金花街的牛羊杂汤<br>3.珍珍小食店</p>
<p>—————————— 夜8路/夜1路 ————————</p>
<p><strong>珠江夜游</strong></p>
<h3 id="Day-5-1-27"><a href="#Day-5-1-27" class="headerlink" title="Day 5 1-27"></a>Day 5 1-27</h3><p>中山大学南校区(2小时) → 红专厂创意园(3小时) → 海心沙广场(1小时) → 广州塔(2小时)</p>
<p><strong>中山大学</strong></p>
<p>———————— 地铁8号线 → 地铁3号线 → 地铁5号线 ————————</p>
<p><strong>红专厂创意园</strong></p>
<p>———————— 地铁5号线 ————————</p>
<p><strong>海心沙广场</strong></p>
<p>———————— 地铁3号线 ————————</p>
<p><strong>广州塔</strong></p>
<h3 id="Day-6-1-28"><a href="#Day-6-1-28" class="headerlink" title="Day 6 1-28"></a>Day 6 1-28</h3><p>今天属于长隆野生动物园<br>3号线、7号线都可以直达，E出口出来有南北两个入口。建议从北门进入。里面禁止带零食进入，当然可以偷偷的带一点点。<br>门票建议淘宝购买，28号当天的门票为240一张。<br>建议早上10点入园，那时候人没有那么多。闭园的时间为下午6点。<br>推荐路线:<br>1、北门进→2、天鹅湖广场→3、乘车游览区→4、侏罗纪森林→5、雨林仙踪→6、金蛇秘境→7、长颈鹿投喂台→8、考拉馆→9、长隆大熊猫中心→10、大象园→11、马园→12、儿童天地→13、非洲森林→14、花果山→15、百虎山→16、动物幼儿园→17、北门出口。</p>
<h3 id="Day-7-1-29"><a href="#Day-7-1-29" class="headerlink" title="Day 7 1-29"></a>Day 7 1-29</h3><p>需在下午7点前赶到潮汕动车站。再打车17分钟即可到机场。回程的飞机起飞时间为间为晚上9:05。</p>
<p><strong>警告：广州到潮汕的动车票需要抢票，在1月18日的时候放票</strong></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://tianxianbob.github.io/2019/01/15/%E6%B1%95%E5%A4%B4-%E5%B9%BF%E5%B7%9E%E6%B8%B8%E7%8E%A9Plan/" data-id="ckrx1o4vi0015bqzbgqgsfc0q" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E7%94%9F%E6%B4%BB/" rel="tag">生活</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-浅拷贝和深拷贝的区别" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/12/06/%E6%B5%85%E6%8B%B7%E8%B4%9D%E5%92%8C%E6%B7%B1%E6%8B%B7%E8%B4%9D%E7%9A%84%E5%8C%BA%E5%88%AB/" class="article-date">
  <time datetime="2018-12-05T16:00:00.000Z" itemprop="datePublished">2018-12-06</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E6%8A%80%E6%9C%AF/">技术</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/12/06/%E6%B5%85%E6%8B%B7%E8%B4%9D%E5%92%8C%E6%B7%B1%E6%8B%B7%E8%B4%9D%E7%9A%84%E5%8C%BA%E5%88%AB/">深拷贝和浅拷贝的区别</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>为什么要写这篇博客？<br>在iOS开发中，我们往往将copy和mutableCopy这两个OC的Api的意思来理解深浅拷贝。尚且不说苹果爸爸对两个Api所做的优化，浅显的把Api的copy和mutableCopy来和深浅拷贝画上等号，那真的就像被OC这座大山阻挡了外面的世界。<br>🙅‍♂️🙅</p>
<p>首先我们要明确，什么是拷贝？为什么要拷贝？<br>比如在Java中，除了基本数据类型之外，还存在类的实例对象这个引用数据类型。而一般的”=”做赋值操作的时候。对于基本数据类型，实际上是拷贝他的值，但是对于对象而言，其实赋值的只是这个对象的引用，将原对象的引用传递过去，他们实际上还是指向同一个对象。</p>
<p>而深浅拷贝就是基于这个基础之上做的区分，如果在拷贝这个对象的时候，只对基本数据类型进行拷贝，而对引用数据类型之作引用传递，而没有真实的创建一个新的对象，则认为是浅拷贝。反之，在对数据进行拷贝的时候，创建了一个新的对象，并复制其内的成员变量，则认为是深拷贝。</p>
<p>其实，以上的解释在OC上同样适用。</p>
<p><em>首先我们要明确一点，不管是深浅拷贝，都会创建新的对象。这也是拷贝的意义所在。</em></p>
<p>那么iOS的同学有话要说～便搬出了如下的数据<br>对数组的实验如下:</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">NSArray</span> *a1 = @[<span class="string">@&quot;1&quot;</span>,<span class="string">@&quot;2&quot;</span>,<span class="string">@&quot;3&quot;</span>,<span class="string">@&quot;4&quot;</span>];</span><br><span class="line"><span class="built_in">NSArray</span> *a2 = a1.copy;</span><br><span class="line"><span class="built_in">NSMutableArray</span> *a3 = a1.mutableCopy;</span><br><span class="line"><span class="built_in">NSArray</span> *a4 = a3.copy;</span><br><span class="line"></span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@&quot;%p == %p == %p == %p&quot;</span>,a1[<span class="number">0</span>],a2[<span class="number">0</span>],a3[<span class="number">0</span>],a4[<span class="number">0</span>]);</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@&quot;%p == %p == %p == %p&quot;</span>,a1,a2,a3,a4);</span><br></pre></td></tr></table></figure>

<p>输出如下:</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2018</span><span class="number">-12</span><span class="number">-07</span> <span class="number">14</span>:<span class="number">17</span>:<span class="number">00.341990</span>+<span class="number">0800</span> CopyDemo[<span class="number">74771</span>:<span class="number">1634466</span>] <span class="number">0x100002070</span> == <span class="number">0x100002070</span> == <span class="number">0x100002070</span> == <span class="number">0x100002070</span></span><br><span class="line"><span class="number">2018</span><span class="number">-12</span><span class="number">-07</span> <span class="number">14</span>:<span class="number">17</span>:<span class="number">00.342254</span>+<span class="number">0800</span> CopyDemo[<span class="number">74771</span>:<span class="number">1634466</span>] <span class="number">0x10052e800</span> == <span class="number">0x10052e800</span> == <span class="number">0x101869990</span> == <span class="number">0x10052e090</span></span><br></pre></td></tr></table></figure>
<p>对字符串的实验如下:</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">NSString</span> *str1 = <span class="string">@&quot;bob&quot;</span>;</span><br><span class="line"><span class="built_in">NSString</span> *str2 = str1.copy;</span><br><span class="line"><span class="built_in">NSString</span> *str3 = str1.mutableCopy;</span><br><span class="line"><span class="built_in">NSString</span> *str4 = str3.copy;</span><br><span class="line"></span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@&quot;%p == %p == %p == %p&quot;</span>,str1,str2,str3,str4);</span><br></pre></td></tr></table></figure>

<p>输出如下:</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2018</span><span class="number">-12</span><span class="number">-07</span> <span class="number">14</span>:<span class="number">24</span>:<span class="number">59.383537</span>+<span class="number">0800</span> CopyDemo[<span class="number">74871</span>:<span class="number">1640100</span>] <span class="number">0x100002060</span> == <span class="number">0x100002060</span> == <span class="number">0x100748b10</span> == <span class="number">0x626f6235</span></span><br></pre></td></tr></table></figure>
<p>分析一下:<br>**NSString(非容器类型)**，str1和a2地址相同，说明没有创建新的对象，所以是浅拷贝。<br>a2和a3地址不一样，所以是深拷贝。<br>a3和a4地址不一样，所以是深拷贝。<br>便得出了下面的结论</p>
<p><strong>非容器类型:</strong></p>
<table>
<thead>
<tr>
<th>对象类型</th>
<th>不可变对象</th>
<th>可变对象</th>
</tr>
</thead>
<tbody><tr>
<td>copy</td>
<td>浅拷贝</td>
<td>深拷贝</td>
</tr>
<tr>
<td>mutableCopy</td>
<td>深拷贝</td>
<td>深拷贝</td>
</tr>
</tbody></table>
<p>**NSArray(容器类型)**，a1和str2地址相同，说明没有创建新的对象，所以是浅拷贝。<br>str2和str3地址不一样，所以是深拷贝。<br>str3和str4地址不一样，所以是深拷贝。<br>便得出了下面的结论</p>
<p><strong>容器类型:</strong></p>
<table>
<thead>
<tr>
<th>对象类型</th>
<th>不可变对象</th>
<th>可变对象</th>
</tr>
</thead>
<tbody><tr>
<td>copy</td>
<td>浅拷贝</td>
<td>深拷贝</td>
</tr>
<tr>
<td>mutableCopy</td>
<td>深拷贝</td>
<td>深拷贝</td>
</tr>
</tbody></table>
<p>…当然根据以上的输出，得出以上结论也不意外。但是答案是错误的～正是因为很多人的认知停留在以上的结论，所以造成了很多人在实际开发中还是会有很多的问题。<br>比如有一次在iOS讨论群里有位同学发出了一下疑问:<br><img src="%E6%B5%85%E6%8B%B7%E8%B4%9D%E5%92%8C%E6%B7%B1%E6%8B%B7%E8%B4%9D%E7%9A%84%E5%8C%BA%E5%88%AB/1-1.png"><br><em>他的问题是array2和array3写法有什么区别？对于数组来说，浅拷贝的意义是啥，有啥意义？</em></p>
<p>如果根据我们在上面得出的结论，确实会有和这位同学有意义的疑问。从地址输出来看引用和浅拷贝(copy)都是地址的引用，那数组的浅拷贝又有什么意义呢？</p>
<p>造成这些问题的根本原因是很多同学把OC的copy这个API和浅拷贝画上了等号。<em>在OC中，对于字面量和数组编译器都是有优化操作的。所以对他们进行实验是根本体现不了我们想要观察深浅拷贝的区别。</em>最合理的方式是写一个NSObject然后实现NSCopying协议。对非容器类型的观察应该用这样的对象而不是NSString。然后把这些对象扔到数组里，然后再去观察容器类型的copy和mutableCopy的区别。这才是在OC中去观察深浅拷贝的正确打开方式。</p>
<p>所以就有了如下的实验。。</p>
<p>创建Person类，有一个NSString类型的name和Son类型的son对象。实现了copy和mutableCopy协议。Son对象有NSString类型的name也实现了copy协议。</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//================.h====================</span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">Son</span> : <span class="title">NSObject</span>&lt;<span class="title">NSCopying</span>&gt;</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">copy</span>) <span class="built_in">NSString</span> *name;</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">Person</span> : <span class="title">NSObject</span>&lt;<span class="title">NSCopying</span>,<span class="title">NSMutableCopying</span>&gt;</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">copy</span>) <span class="built_in">NSString</span> *name;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) Son *son;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">instancetype</span>)initWithName:(<span class="built_in">NSString</span> *)name</span><br><span class="line">                         Son:(Son *)son;</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//================.m====================</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">Son</span></span></span><br><span class="line">- (<span class="keyword">id</span>)copyWithZone:(<span class="built_in">NSZone</span> *)zone</span><br><span class="line">&#123;</span><br><span class="line">    Son *s = [[Son alloc] init];</span><br><span class="line">    s.name = <span class="keyword">self</span>.name.mutableCopy;</span><br><span class="line">    <span class="keyword">return</span> s;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">id</span>)mutableCopyWithZone:(<span class="built_in">NSZone</span> *)zone</span><br><span class="line">&#123;</span><br><span class="line">    Son *s = [[Son alloc] init];</span><br><span class="line">    s.name = <span class="keyword">self</span>.name.mutableCopy;</span><br><span class="line">    <span class="keyword">return</span> s;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">Person</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">instancetype</span>)initWithName:(<span class="built_in">NSString</span> *)name</span><br><span class="line">                         Son:(Son *)son &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span> = [<span class="keyword">super</span> init]) &#123;</span><br><span class="line">        <span class="keyword">self</span>.name = name;</span><br><span class="line">        <span class="keyword">self</span>.son = son;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">id</span>)copyWithZone:(<span class="built_in">NSZone</span> *)zone</span><br><span class="line">&#123;</span><br><span class="line">    Person *p = [[Person alloc] init];</span><br><span class="line">    p.name = <span class="keyword">self</span>.name.copy;</span><br><span class="line">    p.son = <span class="keyword">self</span>.son.copy;</span><br><span class="line">    <span class="keyword">return</span> p;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">id</span>)mutableCopyWithZone:(<span class="built_in">NSZone</span> *)zone</span><br><span class="line">&#123;</span><br><span class="line">    Person *p = [[Person alloc] init];</span><br><span class="line">    p.name = <span class="keyword">self</span>.name.mutableCopy;</span><br><span class="line">    p.son = <span class="keyword">self</span>.son.copy;</span><br><span class="line">    <span class="keyword">return</span> p;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>具体的测试代码如下:</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Son *s = [Son new];</span><br><span class="line">s.name = <span class="string">@&quot;jack&quot;</span>;</span><br><span class="line">Person *p = [[Person alloc] initWithName:<span class="string">@&quot;bob&quot;</span> Son:s];</span><br><span class="line">Person *p2 = p.copy;</span><br><span class="line">Person *p3 = p.mutableCopy;</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@&quot;%p == %p == %p&quot;</span>,p,p2,p3);</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@&quot;name isa:%p == %p == %p&quot;</span>,p.name,p2.name,p3.name);</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@&quot;Son isa:%p == %p == %p&quot;</span>,p.son,p2.son,p3.son);</span><br></pre></td></tr></table></figure>
<p>输出:</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2018</span><span class="number">-12</span><span class="number">-07</span> <span class="number">16</span>:<span class="number">48</span>:<span class="number">49.050049</span>+<span class="number">0800</span> CopyDemo[<span class="number">76533</span>:<span class="number">1726380</span>] <span class="number">0x1005896e0</span> == <span class="number">0x1005879c0</span> == <span class="number">0x1005872c0</span></span><br><span class="line"><span class="number">2018</span><span class="number">-12</span><span class="number">-07</span> <span class="number">16</span>:<span class="number">48</span>:<span class="number">49.050250</span>+<span class="number">0800</span> CopyDemo[<span class="number">76533</span>:<span class="number">1726380</span>] name isa:<span class="number">0x100002068</span> == <span class="number">0x100002068</span> == <span class="number">0x626f6235</span></span><br><span class="line"><span class="number">2018</span><span class="number">-12</span><span class="number">-07</span> <span class="number">16</span>:<span class="number">48</span>:<span class="number">49.050262</span>+<span class="number">0800</span> CopyDemo[<span class="number">76533</span>:<span class="number">1726380</span>] Son isa:<span class="number">0x100550d40</span> == <span class="number">0x100550d40</span> == <span class="number">0x100588ee0</span></span><br><span class="line"><span class="number">2018</span><span class="number">-12</span><span class="number">-07</span> <span class="number">16</span>:<span class="number">48</span>:<span class="number">49.050272</span>+<span class="number">0800</span> CopyDemo[<span class="number">76999</span>:<span class="number">1743990</span>] Son.Name isa:<span class="number">0x100002068</span> == <span class="number">0x100002068</span> == <span class="number">0x6b63616a45</span></span><br></pre></td></tr></table></figure>

<p>以上结果可以看到，无论是copy和mutableCopy，都创建了新的对象。那所谓的深浅拷贝的实质是对象内部属性是否拷贝。<br>可以看到在Person的copy实现中，name属性使用了copy，由于OC编译器的优化，所以浅拷贝前后属性地址相同。Son属性也使用了copy，由于Son是自定义对象，所以copy操作也创建了新的地址。Son对象内部name属性，在浅拷贝的时候使用了copy操作，所以地址相同。<br>在Person的MutableCopy实现中，name属性使用了mutableCopy，所以深拷贝前后属性地址不同，Son属性是对象类型，所以mutableCopy创建了新地址。Son对象内部的name，在深拷贝中用了mutableCopy去操作，所以创建了新的地址。</p>
<p>接下来我们把对象放入到数组:</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">Son *s1 = [Son new];</span><br><span class="line">s1.name = <span class="string">@&quot;jack&quot;</span>;</span><br><span class="line">Person *p1 = [[Person alloc] initWithName:<span class="string">@&quot;bob&quot;</span> Son:s1];</span><br><span class="line">Son *s2 = [Son new];</span><br><span class="line">s2.name = <span class="string">@&quot;rule&quot;</span>;</span><br><span class="line">Person *p2 = [[Person alloc] initWithName:<span class="string">@&quot;lisa&quot;</span> Son:s2];</span><br><span class="line"><span class="built_in">NSArray</span> *a1 = @[p1,p2];</span><br><span class="line"><span class="built_in">NSArray</span> *a2 = a1.copy;</span><br><span class="line"><span class="built_in">NSMutableArray</span> *a3 = a1.mutableCopy;</span><br><span class="line"><span class="built_in">NSArray</span> *a4 = a3.copy;</span><br><span class="line"><span class="built_in">NSMutableArray</span> *a5 = a3.mutableCopy;</span><br><span class="line"><span class="built_in">NSMutableArray</span> *a6 = [[<span class="built_in">NSMutableArray</span> alloc] initWithArray:a1 copyItems:<span class="literal">YES</span>];</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@&quot;a1==%p a2==%p a3==%p a4==%p a5==%p a6==%p&quot;</span>,a1,a2,a3,a4,a5,a6);</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@&quot;a1[0]==%p a2[0]==%p a3[0]==%p a4[0]==%p a5[0]==%p a6[0]==%p&quot;</span>,a1[<span class="number">0</span>],a2[<span class="number">0</span>],a3[<span class="number">0</span>],a4[<span class="number">0</span>],a5[<span class="number">0</span>],a6[<span class="number">0</span>]);</span><br></pre></td></tr></table></figure>
<p>输出如下:</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2018</span><span class="number">-12</span><span class="number">-08</span> <span class="number">09</span>:<span class="number">53</span>:<span class="number">52.387513</span>+<span class="number">0800</span> CopyDemo[<span class="number">83327</span>:<span class="number">2002823</span>] a1==<span class="number">0x1028018a0</span> a2==<span class="number">0x1028018a0</span> a3==<span class="number">0x1028019a0</span> a4==<span class="number">0x102801c40</span> a5==<span class="number">0x102801c70</span> a6==<span class="number">0x102801f10</span></span><br><span class="line"><span class="number">2018</span><span class="number">-12</span><span class="number">-08</span> <span class="number">09</span>:<span class="number">53</span>:<span class="number">52.387960</span>+<span class="number">0800</span> CopyDemo[<span class="number">83327</span>:<span class="number">2002823</span>] a1[<span class="number">0</span>]==<span class="number">0x1028004a0</span> a2[<span class="number">0</span>]==<span class="number">0x1028004a0</span> a3[<span class="number">0</span>]==<span class="number">0x1028004a0</span> a4[<span class="number">0</span>]==<span class="number">0x1028004a0</span> a5[<span class="number">0</span>]==<span class="number">0x1028004a0</span> a6[<span class="number">0</span>]==<span class="number">0x1006000c0</span></span><br></pre></td></tr></table></figure>

<p>第一个输出说明了，对数组进行copy可以看到对NSArray的copy并没有创建新地址，所以可以同理猜想编译器对NSArray做了和NSString相同的优化。数组的mutableCopy创建了新地址，mutableArray的copy和mutableCopy都创建了新地址。<br>第二组输出可以看到数组中的元素地址全部相同，也就是说无论是copy还是mutableCopy，都只拷贝了数组容器（不考虑编译器优化）。所以使用OC中的copy和mutableCopy实际都是浅拷贝。OC有一个==[[NSMutableArray alloc] initWithArray:arr1 copyItems:YES]==方法可以进行深拷贝操作(见a6的输出)。</p>
<p><strong>对于自定义对象来说，深浅拷贝的意义在于对象的属性是否创建新的对象。对于数组来说深浅拷贝的意义在于数组内元素是否被拷贝。</strong></p>
<h4 id="深浅拷贝的应用场景"><a href="#深浅拷贝的应用场景" class="headerlink" title="深浅拷贝的应用场景"></a>深浅拷贝的应用场景</h4><p>在iOS开发中，我们经常会遇到需要维护一个全局id唯一的对象池。比如我们在开发一个小说app，我们可以每次都通过一个id去服务器请求，去刷新本地数据。也可以去维护一个全局的book对象池，这样，即便服务器不下发，我们本地也可以有最全的数据，但是如果一处接口服务器更新，全局的UI都得跟着被更新。所以我们在每个页面的book对象都应该是book对象池的浅拷贝。但是这样做并不是特别的好。因为当业务量大，开发人员多，就会造成一个人对某个对象的错误修改而影响了全局。所以在很多状态和响应流的设计框架里都引入了不可变编程的概念。。保持不可变的要求就是一旦数据变化那就必须是深拷贝。只影响下游数据，而不影响上游数据。在这种程度上来讲，其实每个页面去重新构造数据是一个更好的选择。一旦遵循这个思想，就可以避免一些破坏性编程带来的危害。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://tianxianbob.github.io/2018/12/06/%E6%B5%85%E6%8B%B7%E8%B4%9D%E5%92%8C%E6%B7%B1%E6%8B%B7%E8%B4%9D%E7%9A%84%E5%8C%BA%E5%88%AB/" data-id="ckrx1o4vj0016bqzbap8hbuo3" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/iOS/" rel="tag">iOS</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-[TOC]" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/12/05/%5BTOC%5D/" class="article-date">
  <time datetime="2018-12-04T16:00:00.000Z" itemprop="datePublished">2018-12-05</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E9%9A%8F%E7%AC%94/">随笔</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/12/05/%5BTOC%5D/">星辰的一生</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="赫罗图"><a href="#赫罗图" class="headerlink" title="赫罗图"></a>赫罗图</h2><p>赫罗图是恒星的光谱类型与光度之关系图，赫罗图的纵轴是光度与绝对星等，而横轴则是光谱类型及恒星的表面温度。研究恒星演化的重要工具。<br>从赫罗图上可以看出，恒星主要集中在四个区域。第一个区域为主星序区：银河系中90%以上的恒星都分布在从左上到右下的这一条带子上。这个带上的恒星，有效温度愈高的，光度就愈大。这些星被称为主序星，又称矮星。（太阳、牛郎、织女）<br>第二个区域在主星序右上方：这些恒星的温度和某些主序星的一样，但光度却高得多，因此称之为巨星或超巨星。（北极星（小熊座α）、大角（牧夫座α）为巨星。心宿二（天蝎座α）则为著名的超巨星）<br>第三个区域在主星序左下方：是一些温度高而光度低白矮星，以及其它低光度恒星。（天狼B（即天狼星的伴星）就是最亮的白矮星）<br>第四个区域位于赫罗图上一个很右的位置：温度非常冰冷的星际云在最右边。</p>
<p>赫罗图是由恒星的光学观测数据构成的，因此中子星和黑洞不能在赫罗图上显现</p>
<h3 id="星云——恒星诞生的温床"><a href="#星云——恒星诞生的温床" class="headerlink" title="星云——恒星诞生的温床"></a>星云——恒星诞生的温床</h3><p>是尘埃、氢气、氦气、和其他电离气体聚集的星际云。原本是天文学上通用的名词，泛指任何天文上的扩散天体。<br>鹰星云，法国天文学家梅西耶发现星团周围的星云，形状如一只展翅的老鹰，由哈伯太空望远镜拍摄，著名的“创生之柱”。<br>来自史匹哲太空望远镜的证据表明M16的创生之柱可能已经被一颗爆炸的超新星摧毁。史匹哲在2007年观测到这个区域受到8,000年至9,000年前爆炸的超新星热气体的扰动。而由于星云的距离，这颗超新星的光在1,000年至2,000年前就已经抵达地球。运动更慢的激波要花费数年才会通过星云，可能会吹垮这个微妙的支柱 － 但在下个千禧年之前，被破坏的创生之柱的光还不会抵达地球</p>
<h2 id="主序星"><a href="#主序星" class="headerlink" title="主序星"></a>主序星</h2><h3 id="红矮星——内分泌地下的呆小症患者"><a href="#红矮星——内分泌地下的呆小症患者" class="headerlink" title="红矮星——内分泌地下的呆小症患者"></a>红矮星——内分泌地下的呆小症患者</h3><p>红矮星，也就是M型主序星（MV），根据赫罗图，“红矮星”在众多处于主序阶段的恒星当中，其大小及温度均相对较小和低，在光谱分类方面属于M型。它们在恒星中的数量较多，大多数红矮星的直径及质量均低于太阳的三分一，表面温度也低于3,500 K。释出的光也比太阳弱得多，有时更可低于太阳光度的万分之一。又由于内部的氢元素核聚变的速度缓慢，因此它们也拥有较长的寿命。质量低于0.35太阳质量的红矮星会有充分的对流，氦元素会在恒星内部均匀分布，而不会在核心累积，红矮星不会膨胀成红巨星，而逐步收缩，直至氢气耗尽。它们会保持稳定的光度和光谱持续数千亿年，由于现在宇宙的年龄有限，还没有红矮星发展到之后的阶段。</p>
<h3 id="超巨星——内分泌旺盛的巨人症患者"><a href="#超巨星——内分泌旺盛的巨人症患者" class="headerlink" title="超巨星——内分泌旺盛的巨人症患者"></a>超巨星——内分泌旺盛的巨人症患者</h3><p>传统超巨星均为大质量的恒星，它们至少具有太阳的5倍质量。亮度则为太阳光度的30,000至数百万倍，它们的半径变化也很大，通常是太阳半径的30至500倍，甚至超过1000倍太阳半径。因为她们的质量是如此的巨大，因此寿命只有短暂的一千万至五千万年，所以只存在于年轻的宇宙结构中，像是疏散星团、螺旋星系的漩涡臂，和不规则星系。</p>
<h3 id="太阳——一个健康的茁壮的恒星"><a href="#太阳——一个健康的茁壮的恒星" class="headerlink" title="太阳——一个健康的茁壮的恒星"></a>太阳——一个健康的茁壮的恒星</h3><p>太阳是一颗黄矮星（光谱为G2V），黄矮星的寿命大致为100亿年，目前太阳大约45.7亿岁。 在大约50至60亿年之后，太阳内部的氢元素几乎会全部消耗尽，太阳的核心将发生坍缩，导致温度上升，这一过程将一直持续到太阳开始把氦元素聚变成碳元素。虽然氦聚变产生的能量比氢聚变产生的能量少，但温度也更高，因此太阳的外层将膨胀，并且把一部分外层大气释放到太空中。当转向新元素的过程结束时，太阳的质量将稍微下降，外层将延伸到地球或者火星目前运行的轨道处（这时由于太阳质量的下降，这两颗行星将会离太阳更远）</p>
<h2 id="红巨星——一个自我膨胀的迷失者"><a href="#红巨星——一个自我膨胀的迷失者" class="headerlink" title="红巨星——一个自我膨胀的迷失者"></a>红巨星——一个自我膨胀的迷失者</h2><p>当一颗恒星度过它漫长的青壮年期——主序星阶段，步入老年期时，它将首先变为一颗红巨星。红巨星是恒星燃烧到后期所经历的一个较短的不稳定阶段，根据恒星质量的不同，历时只有数百万年不等，这与恒星几十亿年甚至上百亿年的稳定期相比是非常短暂的。红巨星时期的恒星表面温度相对很低，但极为明亮，因为它们的体积非常巨大。<br>主星序阶段的恒星，核聚变主要在它的中心（核心）部分发生，辐射压与它自身收缩的引力相平衡，恒星内部氢的燃烧消耗极快，中心形成氦核并且不断增大。随着时间的延长，氦核周围的氢越来越少 ，中心核产生的能量已经不足以维持其辐射，于是平衡被打破，引力占了上风，有着氦核和氢外壳的恒星在引力作用下收缩坍塌，使其密度、压强和温度都急剧升高，氢的燃烧向氦核周围的一个壳层里推进。</p>
<h2 id="超新星——银河系50年一次的烟火盛宴"><a href="#超新星——银河系50年一次的烟火盛宴" class="headerlink" title="超新星——银河系50年一次的烟火盛宴"></a>超新星——银河系50年一次的烟火盛宴</h2><p>超新星爆发是某些恒星在演化接近末期时经历的一种剧烈爆炸。这种爆炸度极其明亮，过程中所突发电磁辐射经常能够照亮其所在的整个星系，并可持续几周至几个月（一般最多是两个月）才会逐渐衰减变为不可见。在这段期间内一颗超新星所辐射的能量可以与太阳在其一生中辐射能量的总和相媲美。恒星通过爆炸会将其大部分甚至几乎所有物质以可高至十分之一光速的速度向外抛散，并向周围的星际物质辐射激波。这种激波会导致形成一个膨胀的气体和尘埃构成的壳状结构，这被称作超新星遗迹。由于在一个星系中超新星是很少见的事件，银河系大约每隔50年发生一次，为了得到良好的研究超新星的样本需要定期检测许多星系。</p>
<h2 id="致密星"><a href="#致密星" class="headerlink" title="致密星"></a>致密星</h2><h3 id="白矮星"><a href="#白矮星" class="headerlink" title="白矮星"></a>白矮星</h3><p>白矮星（White Dwarf，也称为简并矮星）是一种低光度、高密度、高温度的恒星。因为它的颜色呈白色、体积比较矮小，因此被命名为白矮星。白矮星是演化到末期的恒星，主要由碳构成，外部覆盖一层氢气与氦气。白矮星在亿万年的时间里逐渐冷却、变暗，它体积小，亮度低，但密度高，质量大。</p>
<h3 id="中子星"><a href="#中子星" class="headerlink" title="中子星"></a>中子星</h3><p>中子星是处于演化后期的恒星，它也是在老年恒星的中心形成的。只不过能够形成中子星的恒星，其质量更大罢了。根据科学家的计算，当老年恒星的质量为太阳质量的约8~2、30倍时，它就有可能最后变为一颗中子星，而质量小于8个太阳的恒星往往只能变化为一颗白矮星。</p>
<h3 id="黑洞"><a href="#黑洞" class="headerlink" title="黑洞"></a>黑洞</h3><p>黑洞是现代广义相对论中，宇宙空间内存在的一种天体。黑洞的引力很大，使得视界内的逃逸速度大于光速。<br>1916年，德国天文学家卡尔·史瓦西通过计算得到了爱因斯坦引力场方程的一个真空解，这个解表明，如果将大量物质集中于空间一点，其周围会产生奇异的现象，即在质点周围存在一个界面——“视界”一旦进入这个界面，即使光也无法逃脱。这种“不可思议的天体”被美国物理学家约翰·阿奇博尔德·惠勒命名为“黑洞”。</p>
<p><strong>产生过程</strong>：某一个恒星在准备灭亡，核心在自身重力的作用下迅速地收缩，塌陷，发生强力爆炸。当核心中所有的物质都变成中子时收缩过程立即停止，被压缩成一个密实的星体，同时也压缩了内部的空间和时间。但在黑洞情况下，由于恒星核心的质量大到使收缩过程无休止地进行下去，连中子间的排斥力也无法阻挡。中子本身在挤压引力自身的吸引下被碾为粉末，剩下来的是一个密度高到难以想象的物质。由于高质量而产生的引力，使得任何靠近它的物体都会被它吸进去。</p>
<p><strong>史瓦西半径</strong>，如果一个重力天体的半径小于史瓦西半径，天体将会发生坍塌。在这个半径以下的天体，其间的时空弯曲得如此厉害，以至于其发射的所有射线，无论是来自什么方向的，都将被吸引入这个天体的中心。因为相对论指出任何物质都不可能超越光速，在史瓦西半径以下的天体的任何物质——包括重力天体的组成物质——都将塌陷于中心部分。一个有理论上无限密度组成的点组成重力奇点（gravitational singularity）。由于在史瓦西半径内连光线都不能逃出黑洞，所以一个典型的黑洞确实是“黑”的。</p>
<h2 id="总结——我们为何要仰望星空"><a href="#总结——我们为何要仰望星空" class="headerlink" title="总结——我们为何要仰望星空"></a>总结——我们为何要仰望星空</h2><p>每当太阳落山，夜幕降临，坐在大地，仰望星空，就能看到一部史诗巨作在眼前上演，这部巨作拥有数十亿演员——恒星。每一颗都有属于自己的传奇。从尘埃和气体云中孕育，点燃核聚变的火花，度过辉煌灿烂的一生，晚年步入红巨星。之后或是变为白矮星，悄然消失;或是成为超新星，上演宇宙中最壮观的烟火秀，留下中子星，甚至是谜一般的黑洞。在恒星步入死亡的过程中，却悄然点燃了生命的种子，散播到宇宙深处……因为你我，皆为星尘。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://tianxianbob.github.io/2018/12/05/[TOC]/" data-id="ckrx1o4uw0001bqzbcrtt7kqw" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E9%9A%8F%E7%AC%94/" rel="tag">随笔</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Appium在mac上的搭建" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/12/01/Appium%E5%9C%A8mac%E4%B8%8A%E7%9A%84%E6%90%AD%E5%BB%BA/" class="article-date">
  <time datetime="2018-11-30T16:00:00.000Z" itemprop="datePublished">2018-12-01</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E6%8A%80%E6%9C%AF/">技术</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/12/01/Appium%E5%9C%A8mac%E4%B8%8A%E7%9A%84%E6%90%AD%E5%BB%BA/">Appium在mac上的搭建</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>由于公司的App组没有测试，所以自动化测试的活当然也是开发做呀。好开心😢。下面是Appium在mac上的安装步骤。</p>
<p><strong>安装必须的组件</strong></p>
<ul>
<li>安装Nodejs</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brew install node</span><br></pre></td></tr></table></figure>

<ul>
<li>安装JDK</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brew cask install java</span><br></pre></td></tr></table></figure>

<ul>
<li>安装Appium</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brew install -g appium</span><br></pre></td></tr></table></figure>

<ul>
<li><p>安装Appium-Desktop</p>
<p><a target="_blank" rel="noopener" href="https://github.com/appium/appium-desktop/releases">appium-desktop</a></p>
</li>
<li><p>安装appium-doctor</p>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install -g appium-doctor</span><br></pre></td></tr></table></figure>

<ul>
<li>校验iOS环境</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">appium-doctor --ios</span><br></pre></td></tr></table></figure>

<p>如果出现<code>Everything looks good, bye!</code>说明appium安装完成。否则根据对应的报错去安装缺的东西。</p>
<p><strong>真机测试配置</strong></p>
<ul>
<li>安装libimobiledevice，这是用于连接 iOS 设备的开源工具，类似于 Android 的 ADB</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brew install libimobiledevice --HEAD</span><br></pre></td></tr></table></figure>

<p>遇到一个问题:<br><code>Requested &#39;libusbmuxd &gt;= 1.1.0&#39; but version of libusbmuxd is 1.0.1</code><br>解决方案:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">brew update</span><br><span class="line">brew uninstall --ignore-dependencies libimobiledevice</span><br><span class="line">brew uninstall --ignore-dependencies usbmuxd</span><br><span class="line">brew install --HEAD usbmuxd</span><br><span class="line">brew unlink usbmuxd</span><br><span class="line">brew link usbmuxd</span><br><span class="line">brew install --HEAD libimobiledevice</span><br></pre></td></tr></table></figure>


<ul>
<li>安装ios-deploy，这是支持使用命令行管理 iOS 设备 app 的工具</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install -g ios-deploy</span><br></pre></td></tr></table></figure>


<ul>
<li><p>前往webDriverAgent目录<br><code>/Applications/Appium.app/Contents/Resources/app/node_modules/appium/node_modules/appium-xcuitest-driver/WebDriverAgent</code></p>
<p>  1.修改bundle identify<br>  2.设置签名证书</p>
<p>  打开工程TARGETS，选择WebDriverAgentLib-&gt;General，修改Bundle Identify<br>  <img src="Appium%E5%9C%A8mac%E4%B8%8A%E7%9A%84%E6%90%AD%E5%BB%BA/1.jpg"><br>  选择IntegrationApp-&gt;General，修改Bundle Identify<br>  <img src="Appium%E5%9C%A8mac%E4%B8%8A%E7%9A%84%E6%90%AD%E5%BB%BA/2.jpg"><br>  选择WebDriverAgentRunner-&gt;Build Settings，修改Bundle Identify<br>  <img src="Appium%E5%9C%A8mac%E4%B8%8A%E7%9A%84%E6%90%AD%E5%BB%BA/4.jpg"></p>
<p>  另外WebDriverAgentLib、IntegrationApp、WebDriverAgentRunner都需要设置签名证书</p>
</li>
<li><p>证书设置完之后，使用command+U运行WebDriverAgentRunner到真机上</p>
</li>
<li><p>运行完之后，真机上会多个WebDriverAgentRunner的App，App启动之后马上退出，这是正常的</p>
</li>
<li><p>这个时候控制台输出<br>  <img src="Appium%E5%9C%A8mac%E4%B8%8A%E7%9A%84%E6%90%AD%E5%BB%BA/5.jpg"></p>
</li>
<li><p>执行以下命令，将 iOS 设备上 WebDriverAgentRunner 监听的 8100 端口映射到 macOS 本地的 8100 端口</p>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iproxy 8100 8100 iOS设备udid</span><br></pre></td></tr></table></figure>

<ul>
<li><p>在浏览器输入<code>http://192.168.2.6:8100/status</code>可查看WebDriverAgentRunner的运行状态<br>  <img src="Appium%E5%9C%A8mac%E4%B8%8A%E7%9A%84%E6%90%AD%E5%BB%BA/6.jpg"></p>
</li>
<li><p>设备上运行，设置Desired Capabilities<br>对应的设备名，bundleId，udid可以进行对应的更改</p>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;platformName&quot;: &quot;ios&quot;,  // 平台</span><br><span class="line">  &quot;deviceName&quot;: &quot;iPhone 8&quot;, // 设备名</span><br><span class="line">  &quot;platformVersion&quot;: &quot;10.3.3&quot;, // 设备系统版本</span><br><span class="line">  &quot;bundleId&quot;: &quot;com.xxx.xxx&quot;, // App Bundle Identify</span><br><span class="line">  &quot;udid&quot;: &quot;ad7cda4b4e7e7201865f5420b340566dd256038e&quot; // 设备udid</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>成功界面<br><img src="Appium%E5%9C%A8mac%E4%B8%8A%E7%9A%84%E6%90%AD%E5%BB%BA/7.jpg"></p>
<p>参考链接<br><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/612c2fa1dbe9">Appium for mac环境配置</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://tianxianbob.github.io/2018/12/01/Appium%E5%9C%A8mac%E4%B8%8A%E7%9A%84%E6%90%AD%E5%BB%BA/" data-id="ckrx1o4v10005bqzbfl6u1k7b" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/iOS/" rel="tag">iOS</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-HTTP和HTTPS的区别" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/11/27/HTTP%E5%92%8CHTTPS%E7%9A%84%E5%8C%BA%E5%88%AB/" class="article-date">
  <time datetime="2018-11-26T16:00:00.000Z" itemprop="datePublished">2018-11-27</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E6%8A%80%E6%9C%AF/">技术</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/11/27/HTTP%E5%92%8CHTTPS%E7%9A%84%E5%8C%BA%E5%88%AB/">HTTP和HTTPS的区别</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>HTTP协议（超文本传输协议）在近30年的发展中，让互联网从只属于少数人，到如今遍布全世界的每一个角落。但是在日常开发中我们可以发现，渐渐的我们的协议名从HTTP变成了HTTPS。什么是HTTP？HTTPS有哪些好处？HTTP和HTTPS究竟有着哪些区别？带着这些问题我们就开始分析吧。</p>
<h4 id="什么是HTTP"><a href="#什么是HTTP" class="headerlink" title="什么是HTTP"></a>什么是HTTP</h4><p>首先我们要了解一下什么是HTTP。<br>HTTP通常被译为超文本传输协议。是Web从客户端到服务器端等一些列运作流程的规范。HTTP协议规定，请求从客户端发出，最后服务器端响应请求并返回。</p>
<p>以下是HTTP中的一些比较重要的知识点。</p>
<p><strong>HTTP是不保存状态的协议</strong><br>HTTP是不保存状态的协议，即无状态。HTTP协议本身不对请求和响应直接的通信状态进行保存。也就是说在HTTP这个级别，协议对发送过的请求或响应都不做持久化处理。</p>
<p><strong>URI</strong><br>HTTP协议使用URI定位互联网上的资源。当客户端请求访问资源而发送请求时，URI需要将作为请求报文中的请求URI包含在内。</p>
<p><strong>HTTP方法</strong><br>HTTP的方法名能明确的告诉服务器意图。</p>
<ul>
<li>GET : 获取资源</li>
<li>POST : 传输实体主体</li>
<li>PUT : 传输文件</li>
<li>HEAD : 获得报文首部</li>
<li>DELETE : 删除文件</li>
<li>OPTIONS : 询问支持的方法</li>
<li>TRACE : 追踪路径</li>
<li>CONNECT : 要求用隧道来连接代理</li>
</ul>
<p><strong>持久连接（keep-alive）</strong><br>在初始的HTTP协议中，每进行一次HTTP通信就要断开一次TCP连接。当下随着HTTP的普及，文档中包含大资源的情况多了起来，这样TCP的连接和断开造成的开销就大了起来。<br>在HTTP/1.1中想出了持久连接。持久连接的特点是只要任意一方没有明确的提出断开连接，则不会断开TCP连接。在HTTP/1.1中，所有连接默认打开持久连接。</p>
<p><strong>管线化</strong><br>持久连接让管线化成为可能。管线化是指，HTTP连接的发送端不用等待即可直接发送下一次请求。这样就能做到并行的去发送多个请求，而不用一个接一个的等待服务器端的响应。</p>
<p><strong>Cookie做状态管理</strong><br>Cookie会根据服务器端报文中的Set-Cookie字段，通知客户端保存Cookie。当下次客户端再次发送请求的时候，客户端会自动在报文中加入Cookie值，服务器端接受到Cookie值后，会去检查究竟是哪一台服务器发送的连接请求，然后对比服务器上的记录，最后得出状态信息。</p>
<p><em><strong>HTTP报文</strong></em><br>用于HTTP协议的交互信息叫做HTTP报文。大致可分为报文首部和报文主体两部分。两者用空行来划分（CR+LF）。通常不一定要有报文主体。</p>
<p><strong>TCP三次握手建立连接</strong><br>为了准确无误的将数据传达到目标处，TCP采用了3次握手策略。用TCP协议把数据包送出去之后，TCP不会对传达后的情况置之不理，而是会向对方确认是否成功送达。握手策略用到TCP的标志——SYN和ACK。<br>发送端先发送一个带SYN的标志的数据包给对方，接受端收到后回传一个带有SYN/ACK标志的数据包以示传达确认信息。最后，发送端再回传一个带ACK标志的数据包，代表握手结束。</p>
<h4 id="HTTP存在哪些缺点"><a href="#HTTP存在哪些缺点" class="headerlink" title="HTTP存在哪些缺点"></a>HTTP存在哪些缺点</h4><p>HTTP主要的缺点，例举如下。</p>
<ul>
<li>通信使用明文（如果不加密的话），内容可能会被窃听。</li>
<li>不验证通信方的身份，因此有可能遭遇伪装。</li>
<li>无法证明报文的完整性，所以有可能已经遭到篡改。</li>
</ul>
<p><strong>网络内容可能被窃听</strong><br>因为HTTP本身不具备加密功能，所以也就无法对报文的整体进行加密。也就是说HTTP报文是以明文传输的。<br>那么为什么明文传输是一个致命的缺陷呢？<br>因为按照TCP/IP协议族的工作机制。通信内容在所有的通信线路上都有可能遭到窥视。所谓的互联网其实就是连通到世界的网络组成的。无论世界上哪个角落的服务器在和客户通信时，在此通信线路上的某些网络设备，光缆，计算机等都不可能是单个人的私有物品，所以不排除某个环节有恶意的窥视行为。<br>即便是加密过信息，还是会被看到通信内容，只不过内容经过加密，看的人可能无法破解。但是报文本身还是会被看到的。<br>窃听相同段的通信也不是难事。只需要收集网络上的流动数据帧就好了。像WiresShark，Charles等都是被广泛使用的抓包工具。</p>
<p><strong>不验证身份，可能遭遇伪装</strong><br>HTTP是不会对请求的发起方和响应方进行身份确认的，所以就会造成发起方接受到伪装服务器的响应，响应方接受到伪装客户端的请求的尴尬局面。正是由于HTTP协议中任意的客户端都可以发起网络请求，且服务器端接受到HTTP请求必然会进行应答。（当请求IP没有被过滤的前提下）<br>所以HTTP协议还是隐患重重:</p>
<ul>
<li>客户端发起网络请求，可能被伪装服务器截取信息。</li>
<li>服务器端响应请求，响应信息也可能被伪装的客户端截取。</li>
<li>无法认证身份，不能确定客户端是否有权限访问特定内容。</li>
<li>无法判定请求方身份。</li>
<li>服务器端不论是请求是否合法都会返回一个响应。Dos（denial of service），拒绝服务攻击。</li>
</ul>
<p><strong>无法确认报文的完整性</strong><br>通俗点来说就是无法确定接收方收到的报文是否和服务器端发送的一模一样。且即便被更改了，接受方是无法察觉的。<br>像这种在传输的途中遭到拦截并恶意篡改报文内容的行为叫做中间人攻击。</p>
<h4 id="HTTP-加密-认证-完整性保护-HTTPS"><a href="#HTTP-加密-认证-完整性保护-HTTPS" class="headerlink" title="HTTP+加密+认证+完整性保护 = HTTPS"></a>HTTP+加密+认证+完整性保护 = HTTPS</h4><p>其实HTTPS（HTTP Secure）也就是针对HTTP最棘手的三个缺点进行优化。<br>HTTPS并不是一种新的协议。只是HTTP的通信接口部分由SSL（Secure Socket Layer）和TLS（Transform Layer Security）所代替。<br>从原来的HTTP直接和TCP通信转变为，HTTP先和SSL通信再由SSL和TCP进行通信。<br>采用了SSL之后，HTTP就有了加密、认证、完整性保护等功能了，且SSL是独立于HTTP的协议，所以他不仅仅在HTTP中可以使用在SMTP和Telnet中均可配合使用。SSL也是应用最广泛的网络安全技术。</p>
<p>相对于HTTP的通信机制，HTTPS的更为复杂。<br>下面是完整的HTTPS通信机制。</p>
<ol>
<li>客户端发送Client Hello报文开始了SSL连接。报文中包含SSL在客户端支持的版本、加密组件列表。</li>
<li>服务器可进行SSL通信时，会以Server Hello作为回报。和客户端一样，也会发送SSL版本及加密组件列表。其加密组件内容时根据客户端发送的筛选出来的。</li>
<li>之后服务器发送Certificate报文。报文中包含公开密匙。</li>
<li>最后服务器发送Server Hello Done，结束SSL握手协议协商部分。</li>
<li>SSL第一次握手结束后，客户端一Client Key Exchange 报文作为回应。报文中包含通信加密中使用的一种被称为Pre-master secret的随机密码串。该报文已用公开密匙加密过。</li>
<li>客户端继续发送Change Cipher Spec报文。报文会提示服务器，在此后的报文会采用Pre-master secret密匙加密。</li>
<li>客户端发送Finished报文。该报文包含连接至今全部报文的整体校验值。致辞握手协商是否能成功，以服务器是否能正确解密该报文为判定标准。</li>
<li>服务器同样发送Change Cipher Spec 报文。</li>
<li>服务器同样发送Finished报文。</li>
<li>客户端和服务器端交换Finished报文之后SSL连接完成。此处开始应用层的协议通信。</li>
<li>发送HTTP响应</li>
<li>最后由客户端断开连接。断开连接时发送close_notify报文。</li>
</ol>
<p>下面是HTTPS通信机制的图解:<br><img src="HTTP%E5%92%8CHTTPS%E7%9A%84%E5%8C%BA%E5%88%AB/t1-1.jpeg"></p>
<p>我将其简化成如下几个步骤:</p>
<ol>
<li>客户端将自己支持的加密算法发送给服务器，请求服务器证书。</li>
<li>服务器选取一组加密算法，并将证书返回给客户端。</li>
<li>客户端校验证书合法性，生成随机对称密钥，用公钥加密后发送给服务器。</li>
<li>服务器用私钥解密出对称密钥，返回一个响应，HTTPS连接建立完成。</li>
<li>随后双方通过这个对称密钥进行安全的数据通信。<br><img src="HTTP%E5%92%8CHTTPS%E7%9A%84%E5%8C%BA%E5%88%AB/t1-2.png"></li>
</ol>
<p><strong>写在最后</strong><br>HTTPS固然是安全可靠的机制。但是也并是所有的请求都非要HTTPS不可。其加密通信相比于纯文本的HTTP是很耗CPU资源的，都用HTTPS的话那么服务器处理请求的能力会大大降低。<br>如果是非敏感信息的话用HTTP是再好不过了，只有包含个人信息等敏感数据时，利用HTTPS才显得格外重要。<br>特别是那些访问并发量很大的网站，服务器承载的负荷不容小觑。只有合理利用HTTP和HTTPS，才能更好的节约资源！</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://tianxianbob.github.io/2018/11/27/HTTP%E5%92%8CHTTPS%E7%9A%84%E5%8C%BA%E5%88%AB/" data-id="ckrx1o4us0000bqzbhe392mvk" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E7%BD%91%E7%BB%9C/" rel="tag">网络</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-[iOS]RAC中的信号筛选操作" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/09/24/%5BiOS%5DRAC%E4%B8%AD%E7%9A%84%E4%BF%A1%E5%8F%B7%E7%AD%9B%E9%80%89%E6%93%8D%E4%BD%9C/" class="article-date">
  <time datetime="2018-09-23T16:00:00.000Z" itemprop="datePublished">2018-09-24</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E6%8A%80%E6%9C%AF/">技术</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/09/24/%5BiOS%5DRAC%E4%B8%AD%E7%9A%84%E4%BF%A1%E5%8F%B7%E7%AD%9B%E9%80%89%E6%93%8D%E4%BD%9C/">RAC中的信号筛选操作</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>过滤操作也属于一种变换，根据过滤条件，过滤出符合条件的值。变换出来的新的信号是原信号的一个子集。</p>
<h3 id="『过滤filter』"><a href="#『过滤filter』" class="headerlink" title="『过滤filter』"></a>『过滤filter』</h3><p> 过滤操作的实现:</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">instancetype</span>)filter:(<span class="built_in">BOOL</span> (^)(<span class="keyword">id</span> value))block &#123;</span><br><span class="line">	<span class="built_in">NSCParameterAssert</span>(block != <span class="literal">nil</span>);</span><br><span class="line"></span><br><span class="line">	Class <span class="keyword">class</span> = <span class="keyword">self</span>.class;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">return</span> [[<span class="keyword">self</span> flattenMap:^ <span class="keyword">id</span> (<span class="keyword">id</span> value) &#123;</span><br><span class="line">		<span class="keyword">if</span> (block(value)) &#123;</span><br><span class="line">			<span class="keyword">return</span> [<span class="keyword">class</span> <span class="keyword">return</span>:value];</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">class</span>.empty;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;] setNameWithFormat:<span class="string">@&quot;[%@] -filter:&quot;</span>, <span class="keyword">self</span>.name];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>入参:一个参数为id类型，返回值的BOOL类型的block，且block不能为空。</p>
<p> 实现:block中传入的是一个筛选条件，如果满足该条件则立即返回原信号的值，否则原信号的值就会返回一个空信号。</p>
</blockquote>
<p>例子:</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">NSArray</span> *array = @[@(<span class="number">1</span>),@(<span class="number">2</span>),@(<span class="number">3</span>),@(<span class="number">4</span>),@(<span class="number">5</span>),@(<span class="number">6</span>),@(<span class="number">7</span>)];</span><br><span class="line">RACSignal *signal = array.rac_sequence.signal;</span><br><span class="line">[[signal filter:^<span class="built_in">BOOL</span>(<span class="keyword">id</span> value) &#123;</span><br><span class="line">    <span class="keyword">return</span> [value integerValue] &gt; <span class="number">6</span>;</span><br><span class="line">&#125;] subscribeNext:^(<span class="keyword">id</span> x) &#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@&quot;%ld&quot;</span>,[x integerValue]);</span><br><span class="line">&#125;];</span><br></pre></td></tr></table></figure>
<p>输出为7。</p>
<hr>
<h3 id="『忽略ignore』"><a href="#『忽略ignore』" class="headerlink" title="『忽略ignore』"></a>『忽略ignore』</h3><p>忽略操作的实现:</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">instancetype</span>)ignore:(<span class="keyword">id</span>)value &#123;</span><br><span class="line">    <span class="keyword">return</span> [[<span class="keyword">self</span> filter:^ <span class="built_in">BOOL</span> (<span class="keyword">id</span> innerValue) &#123;</span><br><span class="line">        <span class="keyword">return</span> innerValue != value &amp;&amp; ![innerValue isEqual:value];</span><br><span class="line">    &#125;] setNameWithFormat:<span class="string">@&quot;[%@] -ignore: %@&quot;</span>, <span class="keyword">self</span>.name, [value rac_description]];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>入参:一个id类型的对象。</p>
</blockquote>
<blockquote>
<p>实现:本质还是一个filter操作，当传入的原信号的值与需要忽略的值相同的时候，返回一个空信号。</p>
</blockquote>
<p>例子:</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">NSArray</span> *ignore_array = @[@(<span class="number">1</span>),@(<span class="number">2</span>),@(<span class="number">3</span>),@(<span class="number">4</span>),@(<span class="number">5</span>)];</span><br><span class="line">RACSignal *ignore_signal = ignore_array.rac_sequence.signal;</span><br><span class="line">[[ignore_signal ignore:@(<span class="number">2</span>)] subscribeNext:^(<span class="keyword">id</span> x) &#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@&quot;value = %ld&quot;</span>,[x integerValue]);</span><br><span class="line">&#125;];</span><br></pre></td></tr></table></figure>
<p>输出：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">value = 1</span><br><span class="line">value = 3</span><br><span class="line">value = 4</span><br><span class="line">value = 5</span><br></pre></td></tr></table></figure>
<hr>
<h3 id="『两两截然不同distinctUntilChanged』"><a href="#『两两截然不同distinctUntilChanged』" class="headerlink" title="『两两截然不同distinctUntilChanged』"></a>『两两截然不同distinctUntilChanged』</h3><p>两两不同实现:</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">instancetype</span>)distinctUntilChanged &#123;</span><br><span class="line">	Class <span class="keyword">class</span> = <span class="keyword">self</span>.class;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> [[<span class="keyword">self</span> bind:^&#123;</span><br><span class="line">		__block <span class="keyword">id</span> lastValue = <span class="literal">nil</span>;</span><br><span class="line">		__block <span class="built_in">BOOL</span> initial = <span class="literal">YES</span>;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span> ^(<span class="keyword">id</span> x, <span class="built_in">BOOL</span> *stop) &#123;</span><br><span class="line">			<span class="keyword">if</span> (!initial &amp;&amp; (lastValue == x || [x isEqual:lastValue])) <span class="keyword">return</span> [<span class="keyword">class</span> empty];</span><br><span class="line"></span><br><span class="line">			initial = <span class="literal">NO</span>;</span><br><span class="line">			lastValue = x;</span><br><span class="line">			<span class="keyword">return</span> [<span class="keyword">class</span> <span class="keyword">return</span>:x];</span><br><span class="line">		&#125;;</span><br><span class="line">	&#125;] setNameWithFormat:<span class="string">@&quot;[%@] -distinctUntilChanged&quot;</span>, <span class="keyword">self</span>.name];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p> 实现:每次变换都记录下原型号的上一个发送过来的值，并与这一次的值进行比较，如果相同，则吃掉该值，返回empty信号。只有和上一次的值不同，才会发送新值。实际就是两两信号间的值是否相同。</p>
</blockquote>
<p>例子:</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">NSArray</span> *array = @[@(<span class="number">1</span>),@(<span class="number">1</span>),@(<span class="number">2</span>),@(<span class="number">3</span>),@(<span class="number">1</span>),@(<span class="number">5</span>)];</span><br><span class="line">    RACSignal *signal = array.rac_sequence.signal;</span><br><span class="line">    [[signal distinctUntilChanged] subscribeNext:^(<span class="keyword">id</span> x) &#123;</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@&quot;value = %ld&quot;</span>,[x integerValue]);</span><br><span class="line">    &#125;];</span><br></pre></td></tr></table></figure>
<p>输出:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">value = 1</span><br><span class="line">value = 2</span><br><span class="line">value = 3</span><br><span class="line">value = 1</span><br><span class="line">value = 5</span><br></pre></td></tr></table></figure>
<hr>
<h3 id="『信号的取值个数take』"><a href="#『信号的取值个数take』" class="headerlink" title="『信号的取值个数take』"></a>『信号的取值个数take』</h3><p>信号取值个数的实现:</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"> - (<span class="keyword">instancetype</span>)take:(<span class="built_in">NSUInteger</span>)count &#123;</span><br><span class="line">	Class <span class="keyword">class</span> = <span class="keyword">self</span>.class;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">return</span> [[<span class="keyword">self</span> bind:^&#123;</span><br><span class="line">		__block <span class="built_in">NSUInteger</span> taken = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span> ^ <span class="keyword">id</span> (<span class="keyword">id</span> value, <span class="built_in">BOOL</span> *stop) &#123;</span><br><span class="line">			RACStream *result = <span class="keyword">class</span>.empty;</span><br><span class="line"></span><br><span class="line">			<span class="keyword">if</span> (taken &lt; count) result = [<span class="keyword">class</span> <span class="keyword">return</span>:value];</span><br><span class="line">			<span class="keyword">if</span> (++taken &gt;= count) *stop = <span class="literal">YES</span>;</span><br><span class="line"></span><br><span class="line">			<span class="keyword">return</span> result;</span><br><span class="line">		&#125;;</span><br><span class="line">	&#125;] setNameWithFormat:<span class="string">@&quot;[%@] -take: %lu&quot;</span>, <span class="keyword">self</span>.name, (<span class="keyword">unsigned</span> <span class="keyword">long</span>)count];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>入参:一个NSUInteger类型的值，表示取值的个数。</p>
<p>实现:通过bind函数，在闭包中从第0个数值开始取值，直到取到第count个的时候，就停止取值。</p>
</blockquote>
<p>例子:</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"> <span class="built_in">NSArray</span> *array = @[@(<span class="number">1</span>),@(<span class="number">2</span>),@(<span class="number">3</span>),@(<span class="number">4</span>),@(<span class="number">5</span>),@(<span class="number">6</span>),@(<span class="number">7</span>)];</span><br><span class="line"> RACSignal *signal = array.rac_sequence.signal;</span><br><span class="line">[[signal take:<span class="number">4</span>] subscribeNext:^(<span class="keyword">id</span> x) &#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@&quot;value = %ld&quot;</span>,[x integerValue]);</span><br><span class="line">&#125;];</span><br></pre></td></tr></table></figure>
<p>输出:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">value = 1</span><br><span class="line">value = 2</span><br><span class="line">value = 3</span><br><span class="line">value = 4</span><br></pre></td></tr></table></figure>
<hr>
<h3 id="『跳过skip』"><a href="#『跳过skip』" class="headerlink" title="『跳过skip』"></a>『跳过skip』</h3><p>跳过的具体实现:</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">instancetype</span>)skip:(<span class="built_in">NSUInteger</span>)skipCount &#123;</span><br><span class="line">	Class <span class="keyword">class</span> = <span class="keyword">self</span>.class;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">return</span> [[<span class="keyword">self</span> bind:^&#123;</span><br><span class="line">		__block <span class="built_in">NSUInteger</span> skipped = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span> ^(<span class="keyword">id</span> value, <span class="built_in">BOOL</span> *stop) &#123;</span><br><span class="line">			<span class="keyword">if</span> (skipped &gt;= skipCount) <span class="keyword">return</span> [<span class="keyword">class</span> <span class="keyword">return</span>:value];</span><br><span class="line"></span><br><span class="line">			skipped++;</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">class</span>.empty;</span><br><span class="line">		&#125;;</span><br><span class="line">	&#125;] setNameWithFormat:<span class="string">@&quot;[%@] -skip: %lu&quot;</span>, <span class="keyword">self</span>.name, (<span class="keyword">unsigned</span> <span class="keyword">long</span>)skipCount];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>skip的实现也是非常的简单，判断当前跳过的个数是否大于传入的skipCount，是的话返回信号的值，否则返回空信号。</p>
</blockquote>
<p>例子:</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">NSArray</span> *array = @[@(<span class="number">1</span>),@(<span class="number">2</span>),@(<span class="number">3</span>),@(<span class="number">4</span>),@(<span class="number">5</span>),@(<span class="number">6</span>),@(<span class="number">7</span>)];</span><br><span class="line">RACSignal *signal = array.rac_sequence.signal;</span><br><span class="line">[[signal skip:<span class="number">4</span>] subscribeNext:^(<span class="keyword">id</span> x) &#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@&quot;value = %ld&quot;</span>,[x integerValue]);</span><br><span class="line">&#125;];</span><br></pre></td></tr></table></figure>
<p>输出:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">value = 5</span><br><span class="line">value = 6</span><br><span class="line">value = 7</span><br><span class="line">value = 8</span><br></pre></td></tr></table></figure>
<hr>
<h3 id="『信号的分组groupBy-transform-』"><a href="#『信号的分组groupBy-transform-』" class="headerlink" title="『信号的分组groupBy:transform:』"></a>『信号的分组groupBy:transform:』</h3><p>信号分组的实现:</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">- (RACSignal *)groupBy:(<span class="keyword">id</span>&lt;<span class="built_in">NSCopying</span>&gt; (^)(<span class="keyword">id</span> object))keyBlock transform:(<span class="keyword">id</span> (^)(<span class="keyword">id</span> object))transformBlock &#123;</span><br><span class="line">    <span class="built_in">NSCParameterAssert</span>(keyBlock != <span class="literal">NULL</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> [[RACSignal createSignal:^(<span class="keyword">id</span>&lt;RACSubscriber&gt; subscriber) &#123;</span><br><span class="line">        <span class="built_in">NSMutableDictionary</span> *groups = [<span class="built_in">NSMutableDictionary</span> dictionary];</span><br><span class="line">        <span class="built_in">NSMutableArray</span> *orderedGroups = [<span class="built_in">NSMutableArray</span> array];</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> [<span class="keyword">self</span> subscribeNext:^(<span class="keyword">id</span> x) &#123;</span><br><span class="line">            <span class="keyword">id</span>&lt;<span class="built_in">NSCopying</span>&gt; key = keyBlock(x);</span><br><span class="line">            RACGroupedSignal *groupSubject = <span class="literal">nil</span>;</span><br><span class="line">            <span class="keyword">@synchronized</span>(groups) &#123;</span><br><span class="line">                groupSubject = groups[key];</span><br><span class="line">                <span class="keyword">if</span> (groupSubject == <span class="literal">nil</span>) &#123;</span><br><span class="line">                    groupSubject = [RACGroupedSignal signalWithKey:key];</span><br><span class="line">                    groups[key] = groupSubject;</span><br><span class="line">                    [orderedGroups addObject:groupSubject];</span><br><span class="line">                    [subscriber sendNext:groupSubject];</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            [groupSubject sendNext:transformBlock != <span class="literal">NULL</span> ? transformBlock(x) : x];</span><br><span class="line">        &#125; error:^(<span class="built_in">NSError</span> *error) &#123;</span><br><span class="line">            [subscriber sendError:error];</span><br><span class="line">            </span><br><span class="line">            [orderedGroups makeObjectsPerformSelector:<span class="keyword">@selector</span>(sendError:) withObject:error];</span><br><span class="line">        &#125; completed:^&#123;</span><br><span class="line">            [subscriber sendCompleted];</span><br><span class="line">            </span><br><span class="line">            [orderedGroups makeObjectsPerformSelector:<span class="keyword">@selector</span>(sendCompleted)];</span><br><span class="line">        &#125;];</span><br><span class="line">    &#125;] setNameWithFormat:<span class="string">@&quot;[%@] -groupBy:transform:&quot;</span>, <span class="keyword">self</span>.name];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>入参:两个闭包，一个叫keyBlock，一个叫transformBlock。具体的作用见实现。</p>
</blockquote>
<blockquote>
<p>实现:整个方法实际是新建了一个信号，并对原信号进行一层包装。keyBlock中传入的当做信号值的key。transform闭包则对传入的值进行了变换。并创建了一个groups字典和orderedGroups的数组。取出groups字典中的的值，如果没有，就创建一个RACGRoupedSignal信号加入到字典和数组中与之对应。然后让当前新建的信号去订阅该信号。订阅之后，orderedGroups就要发送值，如果tansform闭包不为空，就发送变换后的值，反之则发送原来的值。最后，如果发生失败或者分组结束，都要向数组中的每一个信号都发送失败或者成功的信号。</p>
</blockquote>
<p>例子:</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">NSArray</span> *array = @[@(<span class="number">1</span>),@(<span class="number">2</span>),@(<span class="number">3</span>),@(<span class="number">4</span>),@(<span class="number">5</span>),@(<span class="number">6</span>),@(<span class="number">7</span>)];</span><br><span class="line">    RACSignal *signal = array.rac_sequence.signal;</span><br><span class="line">    RACSignal *groupBySignal = [signal groupBy:^<span class="keyword">id</span>&lt;<span class="built_in">NSCopying</span>&gt;(<span class="built_in">NSNumber</span> *object) &#123;</span><br><span class="line">        <span class="keyword">return</span> object.integerValue &gt; <span class="number">5</span> ? <span class="string">@&quot;大于5&quot;</span>:<span class="string">@&quot;小于等于5&quot;</span>;</span><br><span class="line">    &#125; transform:^<span class="keyword">id</span>(<span class="keyword">id</span> object) &#123;</span><br><span class="line">        <span class="keyword">return</span> @([object integerValue] * <span class="number">10</span>);</span><br><span class="line">    &#125;];</span><br><span class="line">    </span><br><span class="line">    [[[groupBySignal filter:^<span class="built_in">BOOL</span>(RACGroupedSignal *value) &#123;</span><br><span class="line">        <span class="keyword">return</span> [(<span class="built_in">NSString</span> *)value.key isEqualToString:<span class="string">@&quot;大于5&quot;</span>];</span><br><span class="line">    &#125;] flatten] subscribeNext:^(<span class="keyword">id</span> x) &#123;</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@&quot;value = %@&quot;</span>,x);</span><br><span class="line">    &#125;];</span><br></pre></td></tr></table></figure>

<p>输出:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">value = 60</span><br><span class="line">value = 70</span><br></pre></td></tr></table></figure>

<hr>
<p>当然这里只是部分信号筛选的一些操作，其他的操作我们下回分解。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://tianxianbob.github.io/2018/09/24/[iOS]RAC%E4%B8%AD%E7%9A%84%E4%BF%A1%E5%8F%B7%E7%AD%9B%E9%80%89%E6%93%8D%E4%BD%9C/" data-id="ckrx1o4v6000bbqzb5ubh22nv" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/iOS/" rel="tag">iOS</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-[iOS]({…})语法的使用" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/09/04/%5BiOS%5D(%7B%E2%80%A6%7D)%E8%AF%AD%E6%B3%95%E7%9A%84%E4%BD%BF%E7%94%A8/" class="article-date">
  <time datetime="2018-09-03T16:00:00.000Z" itemprop="datePublished">2018-09-04</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E6%8A%80%E6%9C%AF/">技术</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/09/04/%5BiOS%5D(%7B%E2%80%A6%7D)%E8%AF%AD%E6%B3%95%E7%9A%84%E4%BD%BF%E7%94%A8/">GCC Code Block Evaluation C Extension {...}的使用</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>重写UI的getter方法，把初始化方法放在getter中，可以有效的较少viewDidLoad的负荷，也能使整个页面变得清晰。同时，可以利用GCC Code Block Evaluation C Extension ({…})的语法，结构化局部变量的初始化和逻辑处理，增加了代码的可读性。</p>
<p>例子:</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="built_in">UIView</span> *)demoView&#123;</span><br><span class="line">        <span class="keyword">if</span> (!_demoView) &#123;</span><br><span class="line">            _demoView = (&#123;</span><br><span class="line">                    <span class="built_in">UIView</span> *demoView = [[<span class="built_in">UIView</span> alloc] initWithFrame:(&#123;</span><br><span class="line">                    <span class="built_in">CGRect</span> rect = <span class="built_in">CGRectMake</span>(SCREEN_WIDTH/<span class="number">2</span><span class="number">-50</span>, SCREEN_HEIGHT/  <span class="number">2</span><span class="number">-100</span>,<span class="number">100</span> ,<span class="number">100</span> );</span><br><span class="line">                    rect;</span><br><span class="line">                &#125;)];</span><br><span class="line">                demoView.backgroundColor = [<span class="built_in">UIColor</span> redColor];</span><br><span class="line">                demoView;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> _demoView;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>


      
    </div>
    <footer class="article-footer">
      <a data-url="https://tianxianbob.github.io/2018/09/04/[iOS](%7B%E2%80%A6%7D)%E8%AF%AD%E6%B3%95%E7%9A%84%E4%BD%BF%E7%94%A8/" data-id="ckrx1o4uz0004bqzb1kurb80q" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/iOS/" rel="tag">iOS</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-[iOS]Load 和 Initialize" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/09/04/%5BiOS%5DLoad%20%E5%92%8C%20Initialize/" class="article-date">
  <time datetime="2018-09-03T16:00:00.000Z" itemprop="datePublished">2018-09-04</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E6%8A%80%E6%9C%AF/">技术</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/09/04/%5BiOS%5DLoad%20%E5%92%8C%20Initialize/">Load 和 Initialize</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>在C语言中，main()是程序最早开始启动和初始化的地方。 在Objective-C中，application，documents，user interface都有自己初始化的地方，所以，在main()中只是简单的调用 NSApplicationMain。 Objective-C中第一个初始化的地方是 +(void)load. 任何class都能有一个＋（void)load。</p>
<h2 id="Load"><a href="#Load" class="headerlink" title="Load"></a>Load</h2><ol>
<li>链接到的框架初始化(包括+load)</li>
<li>当前镜像(image)的+load</li>
<li>当前镜像的C++静态初始化和C/C++ attribute(constructor)构造函数</li>
<li>链接到你的框架初始化。</li>
</ol>
<p>+load方法调用的时候尚未有自动释放池，所以如果+load中的内容使用到了自动释放池，则代码需要用@autoreleasepool{}包含。 另外，对应Category中的+load方法并不会覆盖类自身中的+load方法，两个+load方法都会调用，而且Category的+load方法在类自身的+load方法之后调用。</p>
<h2 id="Initialize"><a href="#Initialize" class="headerlink" title="Initialize"></a>Initialize</h2><p>+initialize方法在一个比较安全的环境中调用，比+load更适合放入初始化代码。+initialize方法在类首次收到消息时调用，若此类一直没有使用，则+initialize就不会调用。 与+load方法类似的时，在向子类发送initialize消息前，总是会先向父类发送initialize消息，如果父类尚未调用+initialize方法则调用</p>
<p>Category中的+initialize方法会覆盖类本身的+initialize方法。如果父类中实现了+initialize方法，而子类中没有重写此方法，则子类初始化时就会使用父类的方法。</p>
<p>如果不想子类使用父类的+initialize方法，则父类的+initialize方法可以这样写</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">+ (<span class="keyword">void</span>)initialize</span><br><span class="line">&#123;</span><br><span class="line">   <span class="keyword">if</span>(<span class="keyword">self</span> == [ParentClass <span class="keyword">class</span>])</span><br><span class="line">   &#123;</span><br><span class="line">     ...init...</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



      
    </div>
    <footer class="article-footer">
      <a data-url="https://tianxianbob.github.io/2018/09/04/[iOS]Load%20%E5%92%8C%20Initialize/" data-id="ckrx1o4v20006bqzbbqy3egfh" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/iOS/" rel="tag">iOS</a></li></ul>

    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/">下一页 &amp;raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">分类</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%90%90%E6%A7%BD/">吐槽</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%8A%80%E6%9C%AF/">技术</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E9%9A%8F%E7%AC%94/">随笔</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">标签</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Git/" rel="tag">Git</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/iOS/" rel="tag">iOS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%94%9F%E6%B4%BB/" rel="tag">生活</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%BD%91%E7%BB%9C/" rel="tag">网络</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%9A%8F%E7%AC%94/" rel="tag">随笔</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">标签云</h3>
    <div class="widget tagcloud">
      <a href="/tags/Git/" style="font-size: 10px;">Git</a> <a href="/tags/iOS/" style="font-size: 20px;">iOS</a> <a href="/tags/%E7%94%9F%E6%B4%BB/" style="font-size: 10px;">生活</a> <a href="/tags/%E7%BD%91%E7%BB%9C/" style="font-size: 10px;">网络</a> <a href="/tags/%E9%9A%8F%E7%AC%94/" style="font-size: 15px;">随笔</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">归档</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/08/">八月 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/01/">一月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/12/">十二月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/11/">十一月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/09/">九月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/06/">六月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/12/">十二月 2017</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">最新文章</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2021/08/04/hello-world/">Hello World</a>
          </li>
        
          <li>
            <a href="/2019/01/27/SVN%E5%88%B0git%E7%9A%84%E8%BF%81%E7%A7%BB/">SVN到Git的迁移</a>
          </li>
        
          <li>
            <a href="/2019/01/15/%E6%B1%95%E5%A4%B4-%E5%B9%BF%E5%B7%9E%E6%B8%B8%E7%8E%A9Plan/">汕头-广州游玩Plan</a>
          </li>
        
          <li>
            <a href="/2018/12/06/%E6%B5%85%E6%8B%B7%E8%B4%9D%E5%92%8C%E6%B7%B1%E6%8B%B7%E8%B4%9D%E7%9A%84%E5%8C%BA%E5%88%AB/">深拷贝和浅拷贝的区别</a>
          </li>
        
          <li>
            <a href="/2018/12/05/%5BTOC%5D/">星辰的一生</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2021 bob<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  
<link rel="stylesheet" href="/fancybox/jquery.fancybox.css">

  
<script src="/fancybox/jquery.fancybox.pack.js"></script>




<script src="/js/script.js"></script>




  </div>
</body>
</html>